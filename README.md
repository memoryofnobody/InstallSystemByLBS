# 订单地图管理系统

基于百度地图API的多角色订单管理系统,支持地图可视化、订单追踪、发货管理和安装记录。

## 快速开始

### 1. 环境要求

- PHP 7.4 或更高版本
- MySQL 5.7 或更高版本
- Apache 2.4 或更高版本
- 百度地图API密钥

### 2. 快速部署

```bash
# 1. 将项目复制到Web服务器目录
# XAMPP: C:\xampp\htdocs\order_system\
# Linux: /var/www/html/order_system/

# 2. 配置数据库连接
# 编辑 config/database.php

# 3. 配置百度地图API密钥
# 编辑 config/config.php 和 index.html

# 4. 初始化数据库
# 访问: http://localhost/order_system/install/install.php

# 5. 登录系统
# 访问: http://localhost/order_system/login.html
# 默认账号: admin / admin
```

详细搭建步骤请查看 [SETUP.md](SETUP.md)

## 核心功能

### 🗺️ 地图可视化
- 订单按安装位置在地图上标注
- 支持点聚合(缩放时自动汇聚/离散)
- 标记显示单位数量和安装进度
- 点击标记查看详细订单信息

### 👥 多角色管理
- **管理员**: 全部功能权限,用户管理
- **买家**: 创建订单,查看自己的订单
- **供应商**: 查看所有订单,录入发货信息
- **安装工程师**: 查看订单,录入安装详情

### 📦 订单管理
- 创建订单(点击地图选择安装位置)
- 订单信息包含:
  - 单位名称、购买/安装数量
  - 安装地址(地图坐标)
  - 联系人信息(下单人、收货人、安装对接人)
  - 安装需求清单(车牌号、终端编号)
  - 备注信息

### 🚚 发货追踪
- 供应商录入发货状态
- 物流单号管理
- 收货确认和数量记录

### 🔧 安装管理
- 安装工程师录入安装详情
- 设备序列号、SIM卡序列号记录
- 自动记录安装时间和工程师
- 实时显示安装进度

### 📊 数据导出
- 支持按订单导出
- 支持按单位汇总导出
- CSV格式,包含完整安装清单

### 🔍 多条件筛选
- 单位名称搜索
- 发货状态筛选
- 收货状态筛选
- 安装状态筛选(全部安装/部分安装/未安装)

## 项目结构

```
order_system/
├── api/                    # 后端API接口
│   ├── login.php          # 用户登录
│   ├── users.php          # 用户管理
│   ├── orders.php         # 订单管理
│   ├── install_requirements.php  # 安装管理
│   ├── map_data.php       # 地图数据
│   └── export.php         # 数据导出
├── config/                # 配置文件
│   ├── config.php         # 全局配置
│   └── database.php       # 数据库配置
├── css/                   # 样式文件
├── js/                    # JavaScript文件
│   ├── common.js          # 公共函数
│   ├── map.js             # 地图功能
│   ├── orders.js          # 订单管理
│   └── users.js           # 用户管理
├── install/               # 安装脚本
├── login.html             # 登录页面
└── index.html             # 主页面
```

## 数据库设计

### users (用户表)
- 用户名、密码、用户类型
- 真实姓名、电话、公司

### orders (订单表)
- 买家ID、单位名称
- 购买数量、安装数量
- 安装地址及坐标
- 联系人信息
- 发货/收货状态

### install_requirements (安装需求表)
- 订单ID、车牌号、终端编号
- 设备序列号、SIM卡序列号
- 安装状态、安装时间、安装工程师

## 技术特点

- ✅ 纯PHP + JavaScript,无需额外框架
- ✅ 响应式设计,支持移动端访问
- ✅ RESTful API设计
- ✅ Session管理,安全认证
- ✅ PDO预处理,防SQL注入
- ✅ 百度地图API集成
- ✅ 点聚合优化性能
- ✅ CSV导出功能

## 使用流程示例

### 买家操作流程
1. 登录系统
2. 点击"创建订单"按钮
3. 在地图上点击选择安装位置
4. 填写订单详细信息
5. 添加安装需求清单(车牌号、终端编号)
6. 提交订单

### 供应商操作流程
1. 登录系统
2. 查看订单列表(支持筛选)
3. 点击"发货"按钮
4. 录入物流单号和收货信息
5. 保存发货记录

### 安装工程师操作流程
1. 登录系统
2. 在地图/列表中查看待安装订单
3. 点击"安装"按钮
4. 录入设备序列号、SIM卡序列号
5. 勾选已安装项目
6. 保存安装记录

## 注意事项

1. **首次使用**: 必须先访问 `install/install.php` 初始化数据库
2. **API密钥**: 需要申请百度地图API密钥并配置
3. **默认账号**: 首次登录后请立即修改admin密码
4. **权限配置**: 确保Web服务器对项目目录有读写权限
5. **生产环境**: 建议启用HTTPS,配置防火墙

## 浏览器支持

- Chrome (推荐)
- Firefox
- Safari
- Edge
- IE 11+

## 许可证

本项目仅供学习和参考使用。

## 联系方式

如有问题或建议,请提交Issue。
